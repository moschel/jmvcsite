(function(f){var a=function(b){return b.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},c=1,h,o,l,j;h=f.View=function(b,e,d,g){var i=b.match(/\.[\w\d]+$/),k,m,p=b;if(typeof d==="function"){g=d;d=undefined}if(!i){i=f.View.ext;p+=f.View.ext}m=a(p);if(p.match(/^\/\//))p=steal.root.join(p.substr(2));i=f.View.types[i];return(b=f.View.cached[m]?f.View.cached[m]:(k=document.getElementById(b))?i.renderer(m,k.innerHTML):j(i,m,p,e,d,g))&&o(b,i,m,e,d,g)};o=function(b,e,d,g,i,k){if(f.View.cache)f.View.cached[d]=
b;b=b.call(e,g,i);k&&k(b);return b};l=function(b,e){if(!b.match(/[^\s]/))throw"$.View ERROR: There is no template or an empty template at "+e;};j=function(b,e,d,g,i,k){if(k)f.ajax({url:d,dataType:"text",error:function(){l("",d)},success:function(p){l(p,d);o(b.renderer(e,p),b,e,g,i,k)}});else{var m=f.ajax({async:false,url:d,dataType:"text",error:function(){l("",d)}}).responseText;l(m,d);return b.renderer(e,m)}};f.extend(f.View,{hookups:{},hookup:function(b){var e=++c;h.hookups[e]=b;return e},cached:{},
cache:true,register:function(b){this.types["."+b.suffix]=b},types:{},ext:".ejs",registerScript:function(b,e,d){return"$.View.preload('"+e+"',"+f.View.types["."+b].script(e,d)+");"},preload:function(b,e){f.View.cached[b]=function(d,g){return e.call(d,d,g)}}});var q,n,t,u,v,r;q=function(b){var e=jQuery.fn[b];jQuery.fn[b]=function(){var d=f.makeArray(arguments),g,i,k=this;if(t(d)){if(g=u(d)){i=d[g];d[g]=function(m){n.call(k,[m],e);i.call(k,m)};f.View.apply(f.View,d);return this}d=[f.View.apply(f.View,
d)]}return n.call(this,d,e)}};n=function(b,e){for(var d in jQuery.View.hookups);if(d)b[0]=f(b[0]);e=e.apply(this,b);d&&v(b[0]);return e};t=function(b){var e=typeof b[1];return typeof b[0]=="string"&&(e=="object"||e=="function")&&!b[1].nodeType&&!b[1].jquery};u=function(b){return typeof b[3]==="function"?3:typeof b[2]==="function"&&2};v=function(b){var e=jQuery.View.hookups,d,g=0,i,k;jQuery.View.hookups={};b=b.add("[data-view-id]",b);for(d=b.length;g<d;g++)if(b[g].getAttribute&&(i=b[g].getAttribute("data-view-id"))&&
(k=e[i])){k(b[g],i);delete e[i];b[g].removeAttribute("data-view-id")}f.extend(jQuery.View.hookups,e)};r=["prepend","append","after","before","replace","text","html","replaceWith"];for(var s=0;s<r.length;s++)q(r[s])})(true);
(function(f){Jaml=function(){return{templates:{},helpers:{},register:function(a,c){this.templates[a]=c},render:function(a,c){return(new Jaml.Template(this.templates[a])).render(c)},registerHelper:function(a,c){this.helpers[a]=c}}}();Jaml.Node=function(a){this.tagName=a;this.attributes={};this.children=[]};Jaml.Node.prototype={setAttributes:function(a){for(var c in a)this.attributes[c=="cls"?"class":c]=a[c]},addChild:function(a){this.children.push(a)},render:function(a){a=a||0;var c=[],h=[],o=this instanceof
Jaml.TextNode,l=this.multiLineTag();for(var j in this.attributes)h.push(j+"="+this.attributes[j]);o||c.push(this.getPadding(a));c.push("<"+this.tagName);for(j in this.attributes)c.push(" "+j+'="'+this.attributes[j]+'"');if(this.isSelfClosing())c.push(" />\n");else{c.push(">");l&&c.push("\n");for(h=0;h<this.children.length;h++)c.push(this.children[h].render(a+2));l&&c.push(this.getPadding(a));c.push("</",this.tagName,">\n")}return c.join("")},multiLineTag:function(){var a=this.children.length,c=a>
0;if(a==1&&this.children[0]instanceof Jaml.TextNode)c=false;return c},getPadding:function(a){return(new Array(a+1)).join(" ")},isSelfClosing:function(){for(var a=false,c=this.selfClosingTags.length-1;c>=0;c--)if(this.tagName==this.selfClosingTags[c])a=true;return a},selfClosingTags:["img","meta","br","hr"]};Jaml.TextNode=function(a){this.text=a};Jaml.TextNode.prototype={render:function(){return this.text}};Jaml.Template=function(a){this.tpl=a;this.nodes=[]};Jaml.Template.prototype={render:function(a){a=
a||{};if(a.constructor.toString().indexOf("Array")==-1)a=[a];with(this)for(var c=0;c<a.length;c++)eval("("+this.tpl.toString()+")(data[i])");a=this.getRoots();var h="";for(c=0;c<a.length;c++)h+=a[c].render();return h},getRoots:function(){for(var a=[],c=0;c<this.nodes.length;c++){var h=this.nodes[c];h.parent==undefined&&a.push(h)}return a},tags:["html","head","body","script","meta","title","link","script","div","p","span","a","img","br","hr","table","tr","th","td","thead","tbody","ul","ol","li","dl",
"dt","dd","h1","h2","h3","h4","h5","h6","h7","form","input","label"]};(function(){for(var a=Jaml.Template.prototype.tags,c=a.length-1;c>=0;c--){var h=a[c];Jaml.Template.prototype[h]=function(o){return function(l){var j=new Jaml.Node(o),q=typeof l=="object"&&!(l instanceof Jaml.Node)&&!(l instanceof Jaml.TextNode);q&&j.setAttributes(l);for(q=q?1:0;q<arguments.length;q++){var n=arguments[q];if(typeof n=="string"||n==undefined)n=new Jaml.TextNode(n||"");if(n instanceof Jaml.Node||n instanceof Jaml.TextNode)n.parent=
j;j.addChild(n)}this.nodes.push(j);return j}}(h)}})();f.View.register({suffix:"jaml",script:function(a,c){return"((function(){ Jaml.register("+a+", "+c+"); return function(data){return Jaml.render("+a+", data)} })())"},renderer:function(a,c){var h;eval("func = ("+c+")");Jaml.register(a,h);return function(o){return Jaml.render(a,o)}}})})(true);
