(function(a){var c=function(b){return b.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},h=1,p,l,i,n;p=a.View=function(b,e,d,f){var g=b.match(/\.[\w\d]+$/),j,k,o=b;if(typeof d==="function"){f=d;d=undefined}if(!g){g=a.View.ext;o+=a.View.ext}k=c(o);if(o.match(/^\/\//))o=steal.root.join(o.substr(2));g=a.View.types[g];return(b=a.View.cached[k]?a.View.cached[k]:(j=document.getElementById(b))?g.renderer(k,j.innerHTML):n(g,k,o,e,d,f))&&l(b,g,k,e,d,f)};l=function(b,e,d,f,g,j){if(a.View.cache)a.View.cached[d]=
b;b=b.call(e,f,g);j&&j(b);return b};i=function(b,e){if(!b.match(/[^\s]/))throw"$.View ERROR: There is no template or an empty template at "+e;};n=function(b,e,d,f,g,j){if(j)a.ajax({url:d,dataType:"text",error:function(){i("",d)},success:function(o){i(o,d);l(b.renderer(e,o),b,e,f,g,j)}});else{var k=a.ajax({async:false,url:d,dataType:"text",error:function(){i("",d)}}).responseText;i(k,d);return b.renderer(e,k)}};a.extend(a.View,{hookups:{},hookup:function(b){var e=++h;p.hookups[e]=b;return e},cached:{},
cache:true,register:function(b){this.types["."+b.suffix]=b},types:{},ext:".ejs",registerScript:function(b,e,d){return"$.View.preload('"+e+"',"+a.View.types["."+b].script(e,d)+");"},preload:function(b,e){a.View.cached[b]=function(d,f){return e.call(d,d,f)}}});var m,q,t,u,v,r;m=function(b){var e=a.fn[b];a.fn[b]=function(){var d=a.makeArray(arguments),f,g,j=this;if(t(d)){if(f=u(d)){g=d[f];d[f]=function(k){q.call(j,[k],e);g.call(j,k)};a.View.apply(a.View,d);return this}d=[a.View.apply(a.View,d)]}return q.call(this,
d,e)}};q=function(b,e){var d;for(var f in jQuery.View.hookups)break;if(f){d=a.View.hookups;a.View.hookups={};b[0]=a(b[0])}e=e.apply(this,b);f&&v(b[0],d);return e};t=function(b){var e=typeof b[1];return typeof b[0]=="string"&&(e=="object"||e=="function")&&!b[1].nodeType&&!b[1].jquery};u=function(b){return typeof b[3]==="function"?3:typeof b[2]==="function"&&2};v=function(b,e){var d,f=0,g,j;b=b.filter(function(){return this.nodeType!=3});b=b.add("[data-view-id]",b);for(d=b.length;f<d;f++)if(b[f].getAttribute&&
(g=b[f].getAttribute("data-view-id"))&&(j=e[g])){j(b[f],g);delete e[g];b[f].removeAttribute("data-view-id")}a.extend(a.View.hookups,e)};r=["prepend","append","after","before","replace","text","html","replaceWith"];for(var s=0;s<r.length;s++)m(r[s])})(jQuery);
(function(){Jaml=function(){return{templates:{},helpers:{},register:function(a,c){this.templates[a]=c},render:function(a,c){return(new Jaml.Template(this.templates[a])).render(c)},registerHelper:function(a,c){this.helpers[a]=c}}}();Jaml.Node=function(a){this.tagName=a;this.attributes={};this.children=[]};Jaml.Node.prototype={setAttributes:function(a){for(var c in a)this.attributes[c=="cls"?"class":c]=a[c]},addChild:function(a){this.children.push(a)},render:function(a){a=a||0;var c=[],h=[],p=this instanceof
Jaml.TextNode,l=this.multiLineTag();for(var i in this.attributes)h.push(i+"="+this.attributes[i]);p||c.push(this.getPadding(a));c.push("<"+this.tagName);for(i in this.attributes)c.push(" "+i+'="'+this.attributes[i]+'"');if(this.isSelfClosing())c.push(" />\n");else{c.push(">");l&&c.push("\n");for(h=0;h<this.children.length;h++)c.push(this.children[h].render(a+2));l&&c.push(this.getPadding(a));c.push("</",this.tagName,">\n")}return c.join("")},multiLineTag:function(){var a=this.children.length,c=a>
0;if(a==1&&this.children[0]instanceof Jaml.TextNode)c=false;return c},getPadding:function(a){return(new Array(a+1)).join(" ")},isSelfClosing:function(){for(var a=false,c=this.selfClosingTags.length-1;c>=0;c--)if(this.tagName==this.selfClosingTags[c])a=true;return a},selfClosingTags:["img","meta","br","hr"]};Jaml.TextNode=function(a){this.text=a};Jaml.TextNode.prototype={render:function(){return this.text}};Jaml.Template=function(a){this.tpl=a;this.nodes=[]};Jaml.Template.prototype={render:function(a){a=
a||{};if(a.constructor.toString().indexOf("Array")==-1)a=[a];with(this)for(var c=0;c<a.length;c++)eval("("+this.tpl.toString()+")(data[i])");a=this.getRoots();var h="";for(c=0;c<a.length;c++)h+=a[c].render();return h},getRoots:function(){for(var a=[],c=0;c<this.nodes.length;c++){var h=this.nodes[c];h.parent==undefined&&a.push(h)}return a},tags:["html","head","body","script","meta","title","link","script","div","p","span","a","img","br","hr","table","tr","th","td","thead","tbody","ul","ol","li","dl",
"dt","dd","h1","h2","h3","h4","h5","h6","h7","form","input","label"]};(function(){for(var a=Jaml.Template.prototype.tags,c=a.length-1;c>=0;c--){var h=a[c];Jaml.Template.prototype[h]=function(p){return function(l){var i=new Jaml.Node(p),n=typeof l=="object"&&!(l instanceof Jaml.Node)&&!(l instanceof Jaml.TextNode);n&&i.setAttributes(l);for(n=n?1:0;n<arguments.length;n++){var m=arguments[n];if(typeof m=="string"||m==undefined)m=new Jaml.TextNode(m||"");if(m instanceof Jaml.Node||m instanceof Jaml.TextNode)m.parent=
i;i.addChild(m)}this.nodes.push(i);return i}}(h)}})();$.View.register({suffix:"jaml",script:function(a,c){return"((function(){ Jaml.register("+a+", "+c+"); return function(data){return Jaml.render("+a+", data)} })())"},renderer:function(a,c){var h;eval("func = ("+c+")");Jaml.register(a,h);return function(p){return Jaml.render(a,p)}}})})(jQuery);
