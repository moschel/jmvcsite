(function(a){var c=function(b){return b.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},j=1,f,n,l;isDeferred=function(b){return b&&a.isFunction(b.always)};getDeferreds=function(b){var d=[];if(isDeferred(b))return[b];else for(var e in b)isDeferred(b[e])&&d.push(b[e]);return d};usefulPart=function(b){return a.isArray(b)&&b.length===3&&b[1]==="success"?b[0]:b};f=a.View=function(b,d,e,g){if(typeof e==="function"){g=e;e=undefined}var h=getDeferreds(d);if(h.length){var i=a.Deferred();h.push(l(b,true));a.when.apply(a,
h).then(function(o){var q=a.makeArray(arguments),r=q.pop()[0];if(isDeferred(d))d=usefulPart(o);else for(var s in d)if(isDeferred(d[s]))d[s]=usefulPart(q.shift());q=r(d,e);i.resolve(q);g&&g(q)});return i.promise()}else{var k;h=typeof g==="function";i=l(b,h);if(h){k=i;i.done(function(o){g(o(d,e))})}else i.done(function(o){k=o(d,e)});return k}};n=function(b,d){if(!b.match(/[^\s]/))throw"$.View ERROR: There is no template or an empty template at "+d;};l=function(b,d){return a.ajax({url:b,dataType:"view",
async:d})};a.ajaxTransport("view",function(b,d){b=d.url;var e=b.match(/\.[\w\d]+$/),g,h,i,k=b,o,q=function(r){r=g.renderer(i,r);if(f.cache)f.cached[i]=r;return{view:r}};if(h=document.getElementById(b))e=h.type.match(/\/[\d\w]+$/)[0].replace(/^\//,".");if(!e){e=f.ext;k+=f.ext}i=c(k);if(k.match(/^\/\//))k=typeof steal==="undefined"?"/"+k.substr(2):steal.root.join(k.substr(2));g=f.types[e];return{send:function(r,s){if(f.cached[i])return s(200,"success",{view:f.cached[i]});else if(h)s(200,"success",q(h.innerHTML));
else o=a.ajax({async:d.async,url:k,dataType:"text",error:function(){n("",k);s(404)},success:function(v){n(v,k);s(200,"success",q(v))}})},abort:function(){o&&o.abort()}}});a.extend(f,{hookups:{},hookup:function(b){var d=++j;f.hookups[d]=b;return d},cached:{},cache:true,register:function(b){this.types["."+b.suffix]=b},types:{},ext:".ejs",registerScript:function(b,d,e){return"$.View.preload('"+d+"',"+f.types["."+b].script(d,e)+");"},preload:function(b,d){f.cached[b]=function(e,g){return d.call(e,e,g)}}});
var p,m,w,x,y,t;p=function(b){var d=a.fn[b];a.fn[b]=function(){var e=a.makeArray(arguments),g,h,i=this;if(w(e)){if(g=x(e)){h=e[g];e[g]=function(k){m.call(i,[k],d);h.call(i,k)};f.apply(f,e);return this}e=f.apply(f,e);if(isDeferred(e)){e.done(function(k){m.call(i,[k],d)});return this}else e=[e]}return m.call(this,e,d)}};m=function(b,d){var e;for(var g in f.hookups)break;if(g){e=f.hookups;f.hookups={};b[0]=a(b[0])}d=d.apply(this,b);g&&y(b[0],e);return d};w=function(b){var d=typeof b[1];return typeof b[0]==
"string"&&(d=="object"||d=="function")&&!b[1].nodeType&&!b[1].jquery};x=function(b){return typeof b[3]==="function"?3:typeof b[2]==="function"&&2};y=function(b,d){var e,g=0,h,i;b=b.filter(function(){return this.nodeType!=3});b=b.add("[data-view-id]",b);for(e=b.length;g<e;g++)if(b[g].getAttribute&&(h=b[g].getAttribute("data-view-id"))&&(i=d[h])){i(b[g],h);delete d[h];b[g].removeAttribute("data-view-id")}a.extend(f.hookups,d)};t=["prepend","append","after","before","text","html","replaceWith","val"];
for(var u=0;u<t.length;u++)p(t[u])})(jQuery);
(function(){Jaml=function(){return{templates:{},helpers:{},register:function(a,c){this.templates[a]=c},render:function(a,c){return(new Jaml.Template(this.templates[a])).render(c)},registerHelper:function(a,c){this.helpers[a]=c}}}();Jaml.Node=function(a){this.tagName=a;this.attributes={};this.children=[]};Jaml.Node.prototype={setAttributes:function(a){for(var c in a)this.attributes[c=="cls"?"class":c]=a[c]},addChild:function(a){this.children.push(a)},render:function(a){a=a||0;var c=[],j=[],f=this instanceof
Jaml.TextNode,n=this.multiLineTag();for(var l in this.attributes)j.push(l+"="+this.attributes[l]);f||c.push(this.getPadding(a));c.push("<"+this.tagName);for(l in this.attributes)c.push(" "+l+'="'+this.attributes[l]+'"');if(this.isSelfClosing())c.push(" />\n");else{c.push(">");n&&c.push("\n");for(j=0;j<this.children.length;j++)c.push(this.children[j].render(a+2));n&&c.push(this.getPadding(a));c.push("</",this.tagName,">\n")}return c.join("")},multiLineTag:function(){var a=this.children.length,c=a>
0;if(a==1&&this.children[0]instanceof Jaml.TextNode)c=false;return c},getPadding:function(a){return(new Array(a+1)).join(" ")},isSelfClosing:function(){for(var a=false,c=this.selfClosingTags.length-1;c>=0;c--)if(this.tagName==this.selfClosingTags[c])a=true;return a},selfClosingTags:["img","meta","br","hr"]};Jaml.TextNode=function(a){this.text=a};Jaml.TextNode.prototype={render:function(){return this.text}};Jaml.Template=function(a){this.tpl=a;this.nodes=[]};Jaml.Template.prototype={render:function(a){a=
a||{};if(a.constructor.toString().indexOf("Array")==-1)a=[a];with(this)for(var c=0;c<a.length;c++)eval("("+this.tpl.toString()+")(data[i])");a=this.getRoots();var j="";for(c=0;c<a.length;c++)j+=a[c].render();return j},getRoots:function(){for(var a=[],c=0;c<this.nodes.length;c++){var j=this.nodes[c];j.parent==undefined&&a.push(j)}return a},tags:["html","head","body","script","meta","title","link","script","div","p","span","a","img","br","hr","table","tr","th","td","thead","tbody","ul","ol","li","dl",
"dt","dd","h1","h2","h3","h4","h5","h6","h7","form","input","label"]};(function(){for(var a=Jaml.Template.prototype.tags,c=a.length-1;c>=0;c--){var j=a[c];Jaml.Template.prototype[j]=function(f){return function(n){var l=new Jaml.Node(f),p=typeof n=="object"&&!(n instanceof Jaml.Node)&&!(n instanceof Jaml.TextNode);p&&l.setAttributes(n);for(p=p?1:0;p<arguments.length;p++){var m=arguments[p];if(typeof m=="string"||m==undefined)m=new Jaml.TextNode(m||"");if(m instanceof Jaml.Node||m instanceof Jaml.TextNode)m.parent=
l;l.addChild(m)}this.nodes.push(l);return l}}(j)}})();$.View.register({suffix:"jaml",script:function(a,c){return"((function(){ Jaml.register("+a+", "+c+"); return function(data){return Jaml.render("+a+", data)} })())"},renderer:function(a,c){var j;eval("func = ("+c+")");Jaml.register(a,j);return function(f){return Jaml.render(a,f)}}})})(jQuery);
