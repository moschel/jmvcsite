(function(h){h.extend(h.EJS.Helpers.prototype,{text:function(a,b){if(a==null||a===undefined)return b||"";if(a instanceof Date)return a.toDateString();if(a.toString)return a.toString().replace(/\n/g,"<br />").replace(/''/g,"'");return""},month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],check_box_tag:function(a,b,c,d){c=c||{};if(d)c.checked="checked";return this.input_field_tag(a,b,"checkbox",c)},date_tag:function(a,b){b instanceof
Date||(b=new Date);var c=[],d=[],e=[],g=b.getFullYear(),i=b.getMonth();b=b.getDate();for(var f=g-15;f<g+15;f++)c.push({value:f,text:f});for(f=0;f<12;f++)d.push({value:f,text:$View.Helpers.month_names[f]});for(f=0;f<31;f++)e.push({value:f+1,text:f+1});c=this.select_tag(a+"[year]",g,c,{id:a+"[year]"});d=this.select_tag(a+"[month]",i,d,{id:a+"[month]"});a=this.select_tag(a+"[day]",b,e,{id:a+"[day]"});return c+d+a},time_tag:function(a,b,c,d){var e=[];if(d==null||d==0)d=60;for(var g=0;g<24;g++)for(var i=
0;i<60;i+=d){var f=(g<10?"0":"")+g+":"+(i<10?"0":"")+i;e.push({text:f,value:f})}return this.select_tag(a,b,e,c)},file_tag:function(a,b,c){return this.input_field_tag(a+"[file]",b,"file",c)},form_tag:function(a,b){b=b||{};if(b.multipart==true){b.method="post";b.enctype="multipart/form-data"}b.action=a;return this.start_tag_for("form",b)},form_tag_end:function(){return this.tag_end("form")},hidden_field_tag:function(a,b,c){return this.input_field_tag(a,b,"hidden",c)},input_field_tag:function(a,b,c,
d){d=d||{};d.id=d.id||a;d.value=b||"";d.type=c||"text";d.name=a;return this.single_tag_for("input",d)},label_tag:function(a,b){b=b||{};return this.start_tag_for("label",b)+a+this.tag_end("label")},link_to:function(a,b,c){a||(a="null");c||(c={});this.set_confirm(c);c.href=b;return this.start_tag_for("a",c)+a+this.tag_end("a")},link_to_if:function(a,b,c,d){return this.link_to_unless(!a,b,c,d)},link_to_unless:function(a,b,c,d){if(a)return b;return this.link_to(b,c,d)},set_confirm:function(a){if(a.confirm){a.onclick=
a.onclick||"";a.onclick=a.onclick+'; var ret_confirm = confirm("'+a.confirm+'"); if(!ret_confirm){ return false;} ';a.confirm=null}},submit_link_to:function(a,b,c){a||(a="null");c||(c={});c.type="submit";c.value=a;this.set_confirm(c);c.onclick=c.onclick+';window.location="'+b+'"; return false;';return this.single_tag_for("input",c)},password_field_tag:function(a,b,c){return this.input_field_tag(a,b,"password",c)},select_tag:function(a,b,c,d){d=d||{};d.id=d.id||a;d.name=a;a="";a+=this.start_tag_for("select",
d);for(d=0;d<c.length;d++){var e=c[d];if(typeof e=="string")e={value:e};if(!e.text)e.text=e.value;if(!e.value)e.text=e.text;var g={value:e.value};if(e.value==b)g.selected="selected";a+=this.start_tag_for("option",g)+e.text+this.tag_end("option")}a+=this.tag_end("select");return a},single_tag_for:function(a,b){return this.tag(a,b,"/>")},start_tag_for:function(a,b){return this.tag(a,b)},submit_tag:function(a,b){b=b||{};b.type=b.type||"submit";b.value=a||"Submit";return this.single_tag_for("input",b)},
tag:function(a,b,c){c=c||">";var d=" ";for(var e in b)if(b.hasOwnProperty(e)){value=b[e]!=null?b[e].toString():"";if(e=="Class"||e=="klass")e="class";d+=value.indexOf("'")!=-1?e+'="'+value+'" ':e+"='"+value+"' "}return"<"+a+d+c},tag_end:function(a){return"</"+a+">"},text_area_tag:function(a,b,c){c=c||{};c.id=c.id||a;c.name=c.name||a;b=b||"";if(c.size){c.cols=c.size.split("x")[0];c.rows=c.size.split("x")[1];delete c.size}c.cols=c.cols||50;c.rows=c.rows||4;return this.start_tag_for("textarea",c)+b+
this.tag_end("textarea")},text_field_tag:function(a,b,c){return this.input_field_tag(a,b,"text",c)},img_tag:function(a,b){b=b||{};b.src=steal.root.join("resources/images/"+a);return this.single_tag_for("img",b)}});h.EJS.Helpers.prototype.text_tag=h.EJS.Helpers.prototype.text_area_tag;var j={},k=0;h.EJS.Helpers.link_data=function(a){var b=k++;j[b]=a;return"_data='"+b+"'"};h.EJS.Helpers.get_data=function(a){if(!a)return null;a=a.getAttribute("_data");if(!a)return null;return j[parseInt(a)]};h.EJS.Helpers.prototype.link_data=
function(a){return h.EJS.Helpers.link_data(a)};h.EJS.Helpers.prototype.get_data=function(a){return h.EJS.Helpers.get_data(a)}})(jQuery);
