(function(g){var k=/([^\[\]]+)|(\[\])/g;g.Controller.History={pathname:function(a){return(a=a.match(/#([^&]*)/))?a[1]:null},search:function(a){return(a=a.match(/#[^&]*&(.*)/))?a[1]:null},getData:function(a){var b=g.Controller.History.search(a);a=/^\d+$/;if(!b||!b.match(/([^?#]*)(#.*)?$/))return{};b=b.replace(/\+/g,"%20");var c={};b=b.split("&");for(var e,j=0;j<b.length;j++){e=c;var d=b[j].split("=");if(d.length!=2)d=[d[0],d.slice(1).join("=")];var f=decodeURIComponent(d[0]);d=decodeURIComponent(d[1]);
f=f.match(k);for(var h=0;h<f.length-1;h++){var i=f[h];e[i]||(e[i]=a.test(i)||f[h+1]=="[]"?[]:{});e=e[i]}lastPart=f[f.length-1];if(lastPart=="[]")e.push(d);else e[lastPart]=d}return c}};jQuery(function(a){a(window).bind("hashchange",function(){var b=a.Controller.History.getData(location.href),c=a.Controller.History.pathname(location.href)||"index";if(c.indexOf("/")==-1&&c!="index")c+="/index";OpenAjax.hub.publish("history."+c.replace("/","."),b)});setTimeout(function(){a(window).trigger("hashchange")},
1)});g.extend(g.Controller.prototype,{redirectTo:function(a){a=this._get_history_point(a);location.hash=a},replaceWith:function(a){a=this._get_history_point(a);location.replace(location.href.split("#")[0]+a)},historyAdd:function(a){a=this._get_history_point(a);location.hash=a},_get_history_point:function(a){var b=a.controller||this.Class.underscoreName,c=a.action||"index";a.controller&&delete a.controller;a.action&&delete a.action;a=a?g.param(a):"";if(a.length)a="&"+a;return"#"+b+"/"+c+a},pathData:function(){return g.Controller.History.getData(location.href)}})})(jQuery);
