(function(b){b.Controller.History={pathname:function(a){return(a=a.match(/#([^&]*)/))?a[1]:null},search:function(a){return(a=a.match(/#[^&]*&(.*)/))?a[1]:null},getData:function(a){a=b.Controller.History.search(a);if(!a||!a.match(/([^?#]*)(#.*)?$/))return{};a=a.replace(/\+/g,"%20");return b.String.deparam(a)}};jQuery(function(a){a(window).bind("hashchange",function(){var d=a.Controller.History.getData(location.href),c=a.Controller.History.pathname(location.href)||"index";if(c.indexOf("/")==-1&&c!=
"index")c+="/index";OpenAjax.hub.publish("history."+c.replace("/","."),d)});setTimeout(function(){a(window).trigger("hashchange")},1)});b.extend(b.Controller.prototype,{redirectTo:function(a){a=this._get_history_point(a);location.hash=a},replaceWith:function(a){a=this._get_history_point(a);location.replace(location.href.split("#")[0]+a)},historyAdd:function(a){a=this._get_history_point(a);location.hash=a},_get_history_point:function(a){var d=a.controller||this.Class.underscoreName,c=a.action||"index";
a.controller&&delete a.controller;a.action&&delete a.action;a=a?b.param(a):"";if(a.length)a="&"+a;return"#"+d+"/"+c+a},pathData:function(){return b.Controller.History.getData(location.href)}})})(jQuery);
