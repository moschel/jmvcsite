(function(c){var h=function(a,b){var d=Array.prototype.slice.call(arguments,2);return function(){var e=[this].concat(d,c.makeArray(arguments));return b.apply(a,e)}},g=c.event;c.Drag=function(){};c.extend(c.Drag,{lowerName:"drag",current:null,mousedown:function(a,b){if(!(!(a.button==0||a.button==1)||this.current)){var d=new c.Drag,e=a.liveFired||b,f=a.handleObj.selector,i=this;this.current=d;d.setup({element:b,delegate:a.liveFired||b,selector:a.handleObj.selector,moved:false,callbacks:{dragdown:g.find(e,
["dragdown"],f),draginit:g.find(e,["draginit"],f),dragover:g.find(e,["dragover"],f),dragmove:g.find(e,["dragmove"],f),dragout:g.find(e,["dragout"],f),dragend:g.find(e,["dragend"],f)},destroyed:function(){i.current=null}},a)}}});c.extend(c.Drag.prototype,{setup:function(a,b){c.extend(this,a);this.element=c(this.element);this.event=b;this.allowOtherDrags=this.moved=false;a=h(this,this.mousemove);var d=h(this,this.mouseup);this._mousemove=a;this._mouseup=d;c(document).bind("mousemove",a);c(document).bind("mouseup",
d);this.callEvents("down",this.element,b)||b.preventDefault()},destroy:function(){c(document).unbind("mousemove",this._mousemove);c(document).unbind("mouseup",this._mouseup);if(!this.moved)this.event=this.element=null;this.destroyed()},mousemove:function(a,b){if(!this.moved){this.init(this.element,b);this.moved=true}a=b.vector();this._start_position&&this._start_position.equals(a)||this.draw(a,b)},mouseup:function(a,b){this.moved&&this.end(b);this.destroy()},noSelection:function(){document.documentElement.onselectstart=
function(){return false};document.documentElement.unselectable="on";c(document.documentElement).css("-moz-user-select","none")},selection:function(){document.documentElement.onselectstart=function(){};document.documentElement.unselectable="off";c(document.documentElement).css("-moz-user-select","")},init:function(a,b){a=c(a);var d=this.movingElement=this.element=c(a);this._cancelled=false;this.event=b;this.mouseStartPosition=b.vector();this.mouseElementPosition=this.mouseStartPosition.minus(this.element.offsetv());
this.callEvents("init",a,b);if(this._cancelled!=true){this.startPosition=d!=this.movingElement?this.movingElement.offsetv():this.currentDelta();this.movingElement.makePositioned();this.oldZIndex=this.movingElement.css("zIndex");this.movingElement.css("zIndex",1E3);!this._only&&this.constructor.responder&&this.constructor.responder.compile(b,this)}},callEvents:function(a,b,d,e){a=this.callbacks[this.constructor.lowerName+a];for(var f=0;f<a.length;f++)a[f].call(b,d,this,e);return a.length},currentDelta:function(){return new c.Vector(parseInt(this.movingElement.css("left"))||
0,parseInt(this.movingElement.css("top"))||0)},draw:function(a,b){if(!this._cancelled){this.location=a.minus(this.mouseElementPosition);this.move(b);if(!this._cancelled){b.isDefaultPrevented()||this.position(this.location);!this._only&&this.constructor.responder&&this.constructor.responder.show(a,this,b)}}},position:function(a){var b=this.movingElement.offsetv(),d=this.currentDelta();b=b.minus(d);this.required_css_position=a.minus(b);a=this.movingElement[0].style;if(!this._cancelled&&!this._horizontal)a.top=
this.required_css_position.top()+"px";if(!this._cancelled&&!this._vertical)a.left=this.required_css_position.left()+"px"},move:function(a){this.callEvents("move",this.element,a)},over:function(a,b){this.callEvents("over",this.element,a,b)},out:function(a,b){this.callEvents("out",this.element,a,b)},end:function(a){if(!this._cancelled){!this._only&&this.constructor.responder&&this.constructor.responder.end(a,this);this.callEvents("end",this.element,a);if(this._revert){var b=this;this.movingElement.animate({top:this.startPosition.top()+
"px",left:this.startPosition.left()+"px"},function(){b.cleanup.apply(b,arguments)})}else this.cleanup();this.event=null}},cleanup:function(){this.movingElement.css({zIndex:this.oldZIndex});this.movingElement[0]!==this.element[0]&&this.movingElement.css({display:"none"});this._removeMovingElement&&this.movingElement.remove();this.movingElement=this.element=this.event=null},cancel:function(){this._cancelled=true;!this._only&&this.constructor.responder&&this.constructor.responder.clear(this.event.vector(),
this,this.event);this.destroy()},ghost:function(a){var b=this.movingElement.clone().css("position","absolute");(a?c(a):this.movingElement).after(b);b.width(this.movingElement.width()).height(this.movingElement.height());this.movingElement=b;this._removeMovingElement=true;return b},representative:function(a,b,d){this._offsetX=b||0;this._offsetY=d||0;b=this.mouseStartPosition;this.movingElement=c(a);this.movingElement.css({top:b.y()-this._offsetY+"px",left:b.x()-this._offsetX+"px",display:"block",position:"absolute"}).show();
this.mouseElementPosition=new c.Vector(this._offsetX,this._offsetY)},revert:function(a){this._revert=a==null?true:a},vertical:function(){this._vertical=true},horizontal:function(){this._horizontal=true},only:function(a){return this._only=a===undefined?true:a}});g.setupHelper(["dragdown","draginit","dragover","dragmove","dragout","dragend"],"mousedown",function(a){c.Drag.mousedown.call(c.Drag,a,this)})})(jQuery);
