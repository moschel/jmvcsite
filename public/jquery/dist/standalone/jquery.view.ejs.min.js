(function(f){var m=function(a){eval(a)},n=function(a){return a.substr(0,a.length-1)},k=f.extend,o=f.isArray,e=function(a){if(this.constructor!=e){var b=new e(a);return function(c,g){return b.render(c,g)}}if(typeof a=="function"){this.template={};this.template.process=a}else{f.extend(this,e.options,a);var d=new e.Compiler(this.text,this.type);d.compile(a,this.name);this.template=d}},p=/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/;f.EJS=e;e.prototype={constructor:e,render:function(a,b){a=a||
{};this._extra_helpers=b;b=new e.Helpers(a,b||{});return this.template.process.call(a,a,b)},out:function(){return this.template.out}};e.text=function(a){if(typeof a=="string")return a;var b;if(a===null||a===undefined)return"";if(a instanceof Date)return a.toDateString();if(a.hookup){b=f.View.hookup(function(d,c){a.hookup.call(a,d,c)});return"data-view-id='"+b+"'"}if(typeof a=="function")return"data-view-id='"+f.View.hookup(a)+"'";if(o(a)){b=f.View.hookup(function(d,c){for(var g=0;g<a.length;g++)a[g].hookup?
a[g].hookup(d,c):a[g](d,c)});return"data-view-id='"+b+"'"}if(a.nodeName||a.jQuery)throw"elements in views are not supported";if(a.toString)return b?a.toString(b):a.toString();return""};e.Scanner=function(a,b,d){k(this,{leftDelimiter:b+"%",rightDelimiter:"%"+d,doubleLeft:b+"%%",doubleRight:"%%"+d,leftEqual:b+"%=",leftComment:b+"%#"});this.splitRegexp=b=="["?p:new RegExp("("+[this.doubleLeft,this.doubleRight,this.leftEqual,this.leftComment,this.leftDelimiter,this.rightDelimiter+"\n",this.rightDelimiter,
"\n"].join(")|(")+")");this.source=a;this.lines=0};e.Scanner.prototype={scan:function(a){var b=this.splitRegexp;if(this.source)for(var d=f.String.rsplit(this.source,/\n/),c=0;c<d.length;c++)this.scanline(d[c],b,a)},scanline:function(a,b,d){this.lines++;a=f.String.rsplit(a,b);for(var c=0;c<a.length;c++){b=a[c];if(b!==null)try{d(b,this)}catch(g){throw{type:"jQuery.EJS.Scanner",line:this.lines};}}}};e.Buffer=function(a,b){this.line=[];this.script=[];this.post_cmd=b;this.push.apply(this,a)};e.Buffer.prototype=
{push:function(){this.line.push.apply(this.line,arguments)},cr:function(){this.script.push(this.line.join(""),"\n");this.line=[]},close:function(){if(this.line.length>0){this.script.push(this.line.join(""));this.line=[]}this.post_cmd.length&&this.push.apply(this,this.post_cmd);this.script.push(";");return this.script.join("")}};e.Compiler=function(a,b){this.source=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n");b=b||"<";a=">";switch(b){case "[":a="]";break;case "<":break;default:throw b+" is not a supported deliminator";
}this.scanner=new e.Scanner(this.source,b,a);this.out=""};e.Compiler.prototype={compile:function(a,b){a=a||{};this.out="";var d=new e.Buffer(["var ___v1ew = [];"],[]),c="",g=function(i){return i.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')},l=function(i){d.push("___v1ew.push(",'"',g(i),'");')},j=null;this.scanner.scan(function(i,h){if(j===null)switch(i){case "\n":c+="\n";l(c);d.cr();c="";break;case h.leftDelimiter:case h.leftEqual:case h.leftComment:j=i;c.length>0&&l(c);c="";break;
case h.doubleLeft:c+=h.leftDelimiter;break;default:c+=i;break}else switch(i){case h.rightDelimiter:switch(j){case h.leftDelimiter:if(c[c.length-1]=="\n"){c=n(c);d.push(c,";");d.cr()}else d.push(c,";");break;case h.leftEqual:d.push("___v1ew.push(","(jQuery.EJS.text(",c,")));");break}j=null;c="";break;case h.doubleRight:c+=h.rightDelimiter;break;default:c+=i;break}});c.length>0&&d.push("___v1ew.push(",'"',g(c)+'");');this.out="try { with(_VIEW) { with (_CONTEXT) {"+d.close()+" return ___v1ew.join('');}}}catch(e){e.lineNumber=null;throw e;}";
m.call(this,"this.process = (function(_CONTEXT,_VIEW){"+this.out+"});\r\n//@ sourceURL="+b+".js")}};e.options={cache:true,type:"<",ext:".ejs"};e.Helpers=function(a,b){this._data=a;this._extras=b;k(this,b)};e.Helpers.prototype={plugin:function(){var a=f.makeArray(arguments),b=a.shift();return function(d){d=f(d);d[b].apply(d,a)}},view:function(a,b,d){d=d||this._extras;b=b||this._data;return f.View(a,b,d)}};f.View.register({suffix:"ejs",script:function(a,b){return"jQuery.EJS(function(_CONTEXT,_VIEW) { "+
(new e({text:b})).out()+" })"},renderer:function(a,b){var d=new e({text:b,name:a});return function(c,g){return d.render.call(d,c,g)}}})})(jQuery);
