(function(b){var j=b.ajax;b.fixture=function(a){var c=a.url,e;c=c.replace(/%2F/g,"~").replace(/%20/g,"_");if(a.data&&a.processData&&typeof a.data!=="string")a.data=jQuery.param(a.data);if(a.data&&a.type.toLowerCase()=="get")c+=(b.String.include(c,"?")?"&":"?")+a.data;c=c.match(/^(?:https?:\/\/[^\/]*)?\/?([^\?]*)\??(.*)?/);e=c[1];a=a.type?"."+a.type.toLowerCase():".post";if(c[2]){e+="/";a=c[2].replace(/\#|&/g,"-").replace(/\//g,"~")+a}return e+a};b.extend(b.fixture,{"-restUpdate":function(a,c){switch(c){case "success":return[b.extend({id:parseInt(a.url,
10)},a.data),"success",b.fixture.xhr()];case "complete":return[b.fixture.xhr(),"success"]}},"-restDestroy":function(a,c){switch(c){case "success":return[true,"success",b.fixture.xhr()];case "complete":return[b.fixture.xhr(),"success"]}},"-restCreate":function(a,c){switch(c){case "success":return[{id:parseInt(Math.random()*1E3,10)},"success",b.fixture.xhr()];case "complete":return[b.fixture.xhr({getResponseHeader:function(){return a.url+"/"+parseInt(Math.random()*1E3,10)}}),"success"]}},make:function(a,
c,e){for(var d=b.fixture["~"+a[0]]=[],g=0;g<c;g++){var o=e(g,d);if(!o.id)o.id=g;d.push(o)}b.fixture["-"+a[0]]=function(h){var f=d.slice(0);b.each((h.data.order||[]).slice(0).reverse(),function(r,p){var i=p.split(" ");f=f.sort(function(k,l){return i[1].toUpperCase()!=="ASC"?k[i[0]]<l[i[0]]:k[i[0]]>l[i[0]]})});b.each((h.data.group||[]).slice(0).reverse(),function(r,p){var i=p.split(" ");f=f.sort(function(k,l){return k[i[0]]>l[i[0]]})});var q=parseInt(h.data.offset,10)||0,s=parseInt(h.data.limit,10)||
c-q,m=0;for(var n in h.data)if(n.indexOf("Id")!=-1||n.indexOf("_id")!=-1)for(;m<f.length;)if(h.data[n]!=f[m][n])f.splice(m,1);else m++;return[{count:f.length,limit:h.data.limit,offset:h.data.offset,data:f.slice(q,q+s)}]};b.fixture["-"+a[1]]=function(h){for(var f=0;f<c;f++)if(h.data.id==d[f].id)return[d[f]]}},xhr:function(a){return b.extend({},{abort:b.noop,getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},open:b.noop,overrideMimeType:b.noop,readyState:4,responseText:"",
responseXML:null,send:b.noop,setRequestHeader:b.noop,status:200,statusText:"OK"},a)}});b.fixture.delay=200;b.fixture["-handleFunction"]=function(a){if(typeof a.fixture==="string"&&b.fixture[a.fixture])a.fixture=b.fixture[a.fixture];if(typeof a.fixture=="function"){setTimeout(function(){a.success&&a.success.apply(null,a.fixture(a,"success"));a.complete&&a.complete.apply(null,a.fixture(a,"complete"))},b.fixture.delay);return true}return false};b.ajax=function(a){var c=b.fixture;if(!a.fixture)return j.apply(b,
arguments);if(!b.fixture["-handleFunction"](a)){if(typeof a.fixture=="string"){c=a.fixture;if(/^\/\//.test(c))c=steal.root.join(a.fixture.substr(2));steal.dev.log("looking for fixture in "+c);a.url=c;a.data=null;a.type="GET";if(!a.error)a.error=function(e,d,g){throw"fixtures.js Error "+d+" "+g;};return j(a)}a=jQuery.extend(true,a,jQuery.extend(true,{},jQuery.ajaxSettings,a));a.url=steal.root.join("test/fixtures/"+c(a));a.data=null;a.type="GET";return j(a)}};b.extend(b.ajax,j);b.get=function(a,c,e,
d,g){if(jQuery.isFunction(c)){g=d;d=e;e=c;c=null}return jQuery.ajax({type:"GET",url:a,data:c,success:e,dataType:d,fixture:g})};b.post=function(a,c,e,d,g){if(jQuery.isFunction(c)){g=d;d=e;e=c;c={}}return jQuery.ajax({type:"POST",url:a,data:c,success:e,dataType:d,fixture:g})}})(jQuery);
