(function(r){var s={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},z=function(f,o,p){return f[o]||p&&(f[o]={})},A=function(f){return(f=typeof f)&&(f=="function"||f=="object")},x=function(f,o,p){f=f?f.split(s.dot):[];var q=f.length;o=r.isArray(o)?o:[o||window];var d,j,m,g=0;if(q==0)return o[0];for(;d=o[g++];){for(m=0;m<q-1&&A(d);m++)d=z(d,f[m],p);if(A(d)){j=z(d,f[m],p);if(j!==undefined){p===false&&delete d[f[m]];
return j}}}},v=r.String=r.extend(r.String||{},{getObject:x,capitalize:function(f){return f.charAt(0).toUpperCase()+f.substr(1)},camelize:function(f){f=v.classize(f);return f.charAt(0).toLowerCase()+f.substr(1)},classize:function(f,o){f=f.split(s.undHash);for(var p=0;p<f.length;p++)f[p]=v.capitalize(f[p]);return f.join(o||"")},niceName:function(){v.classize(parts[i]," ")},underscore:function(f){return f.replace(s.colons,"/").replace(s.words,"$1_$2").replace(s.lowUp,"$1_$2").replace(s.dash,"_").toLowerCase()},
sub:function(f,o,p){var q=[];q.push(f.replace(s.replacer,function(d,j){d=x(j,o,typeof p=="boolean"?!p:p);j=typeof d;if((j==="object"||j==="function")&&j!==null){q.push(d);return""}else return""+d}));return q.length<=1?q[0]:q}})})(jQuery);
(function(r){var s=false,z=r.makeArray,A=r.isFunction,x=r.isArray,v=r.extend,f=function(d,j){return d.concat(z(j))},o=/xyz/.test(function(){})?/\b_super\b/:/.*/,p=function(d,j,m){m=m||d;for(var g in d)m[g]=A(d[g])&&A(j[g])&&o.test(d[g])?function(w,t){return function(){var u=this._super,a;this._super=j[w];a=t.apply(this,arguments);this._super=u;return a}}(g,d[g]):d[g]},q=r.Class=function(){arguments.length&&q.extend.apply(q,arguments)};v(q,{callback:function(d){var j=z(arguments),m;d=j.shift();x(d)||
(d=[d]);m=this;return function(){for(var g=f(j,arguments),w,t=d.length,u=0,a;u<t;u++)if(a=d[u]){if((w=typeof a=="string")&&m._set_called)m.called=a;g=(w?m[a]:a).apply(m,g||[]);if(u<t-1)g=!x(g)||g._use_call?[g]:g}return g}},getObject:r.String.getObject,newInstance:function(){var d=this.rawInstance(),j;if(d.setup)j=d.setup.apply(d,arguments);if(d.init)d.init.apply(d,x(j)?j:arguments);return d},setup:function(d){this.defaults=v(true,{},d.defaults,this.defaults);return arguments},rawInstance:function(){s=
true;var d=new this;s=false;return d},extend:function(d,j,m){function g(){if(!s)return this.constructor!==g&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}if(typeof d!="string"){m=j;j=d;d=null}if(!m){m=j;j=null}m=m||{};var w=this,t=this.prototype,u,a,b,c;s=true;c=new this;s=false;p(m,t,c);for(u in this)if(this.hasOwnProperty(u))g[u]=this[u];p(j,this,g);if(d){b=d.split(/\./);a=b.pop();b=t=q.getObject(b.join("."),window,
true);t[a]=g}v(g,{prototype:c,namespace:b,shortName:a,constructor:g,fullName:d});g.prototype.Class=g.prototype.constructor=g;w=g.setup.apply(g,f([w],arguments));if(g.init)g.init.apply(g,w||[]);return g}});q.prototype.callback=q.callback})(jQuery);
(function(){var r=$.String.underscore,s=$.String.classize,z=$.isArray,A=$.makeArray,x=$.extend,v=$.each,f=/GET|POST|PUT|DELETE/i,o=function(a,b,c,h,k,e,l){l=l||"json";var n="";if(typeof a=="string"){var y=a.indexOf(" ");if(y>2&&y<7){n=a.substr(0,y);if(f.test(n))e=n;else l=n;n=a.substr(y+1)}else n=a}b=x({},b);a=$.String.sub(n,b,true);return $.ajax({url:a,data:b,success:c,error:h,type:e||"post",dataType:l,fixture:k})},p=function(a,b){var c=r(this.shortName),h="-"+c+(a||"");return $.fixture&&$.fixture[h]?
h:b||"//"+r(this.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+c+(a||"")+".json"},q=function(a,b){a=a||{};var c=this.id;if(a[c]&&a[c]!==b){a["new"+$.String.capitalize(b)]=a[c];delete a[c]}a[c]=b;return a},d=function(a){return new (a||$.Model.List||Array)},j=function(a){return a[a.Class.id]},m=function(a){for(var b=[],c=0;c<a.length;c++)if(!a[c]["__u Nique"]){b.push(a[c]);a[c]["__u Nique"]=true}for(c=0;c<b.length;c++)delete b[c]["__u Nique"];return b},g=function(a,b,c,h,k){var e=
$.Deferred(),l=[a.attrs(),function(n){a[k||b+"d"](n);e.resolveWith(a,[a,n,b])},function(n){e.rejectWith(a,[n])}];b=="destroy"&&l.shift();b!=="create"&&l.unshift(j(a));e.then(c);e.fail(h);a.Class[b].apply(a.Class,l);return e.promise()},w=function(a){return typeof a==="object"&&a!==null&&a},t=function(a){return function(){$.fn[a].apply($([this]),arguments);return this}},u=t("bind");t=t("unbind");ajaxMethods={create:function(a){return function(b,c,h){return o(a,b,c,h,"-restCreate")}},update:function(a){return function(b,
c,h,k){return o(a,q.call(this,c,b),h,k,"-restUpdate","put")}},destroy:function(a){return function(b,c,h){var k={};k[this.id]=b;return o(a,k,c,h,"-restDestroy","delete")}},findAll:function(a){return function(b,c,h){return o(a||this.shortName+"s.json",b,c,h,p.call(this,"s"),"get","json "+this._shortName+".models")}},findOne:function(a){return function(b,c,h){return o(a,b,c,h,p.call(this),"get","json "+this._shortName+".model")}}};jQuery.Class("jQuery.Model",{setup:function(a){var b=this;v(["attributes",
"associations","validations"],function(k,e){if(!b[e]||a[e]===b[e])b[e]={}});if(a.convert!=this.convert)this.convert=x(a.convert,this.convert);this._fullName=r(this.fullName.replace(/\./g,"_"));this._shortName=r(this.shortName);if(this.fullName.substr(0,7)!="jQuery."){if(this.listType)this.list=new this.listType([]);for(var c in ajaxMethods)if(typeof this[c]!=="function")this[c]=ajaxMethods[c](this[c]);c={};var h="* "+this._shortName+".model";c[h+"s"]=this.callback("models");c[h]=this.callback("model");
$.ajaxSetup({converters:c})}},attributes:{},model:function(a){if(!a)return null;return new this(w(a[this._shortName])||w(a.data)||w(a.attributes)||a)},models:function(a){if(!a)return null;var b=d(this.List),c=z(a),h=c?a:a.data,k=h.length,e=0;for(b._use_call=true;e<k;e++)b.push(this.model(h[e]));if(!c)for(var l in a)if(l!=="data")b[l]=a[l];return b},id:"id",addAttr:function(a,b){if(!this.associations[a]){this.attributes[a]||(this.attributes[a]=b);return b}},_models:{},publish:function(a,b){window.OpenAjax&&
OpenAjax.hub.publish(this._shortName+"."+a,b)},guessType:function(){return"string"},convert:{date:function(a){return typeof a==="string"?isNaN(Date.parse(a))?null:Date.parse(a):a},number:function(a){return parseFloat(a)},"boolean":function(a){return Boolean(a)}},bind:u,unbind:t},{setup:function(a){this._init=true;this.attrs(x({},this.Class.defaults,a));delete this._init},update:function(a,b,c){this.attrs(a);return this.save(b,c)},errors:function(a){if(a)a=z(a)?a:A(arguments);var b={},c=this,h=function(e,
l){v(l,function(n,y){if(n=y.call(c)){b.hasOwnProperty(e)||(b[e]=[]);b[e].push(n)}})};v(a||this.Class.validations||{},function(e,l){if(typeof e=="number"){e=l;l=c.Class.validations[e]}h(e,l||[])});for(var k in b)if(b.hasOwnProperty(k))return b;return null},attr:function(a,b,c,h){var k=s(a),e="get"+k;if(b!==undefined){this._setProperty(a,b,c,h,k);return this}return this[e]?this[e]():this[a]},bind:u,unbind:t,_setProperty:function(a,b,c,h,k){k="set"+k;var e=this[a],l=this,n=function(y){h&&h.call(l,y);
$(l).triggerHandler("error."+a,y)};this[k]&&(b=this[k](b,this.callback("_updateProperty",a,b,e,c,n),n))===undefined||this._updateProperty(a,b,e,c,n)},_updateProperty:function(a,b,c,h,k){var e=this.Class,l=e.attributes[a]||e.addAttr(a,e.guessType(b)),n=e.convert[l];l=null;b=this[a]=b===null?null:n?n.call(e,b):b;this._init||(l=this.errors(a));if(l)k(l);else{if(c!==b&&!this._init){$(this).triggerHandler(a,[b]);$(this).triggerHandler("updated.attr",[a,b,c])}h&&h(this)}if(a===e.id&&b!==null&&e.list)if(c){if(c!=
b){e.list.remove(c);e.list.push(this)}}else e.list.push(this)},attrs:function(a){var b;if(a){var c=this.Class.id;for(b in a)b!=c&&this.attr(b,a[b]);c in a&&this.attr(c,a[c])}else{a={};for(b in this.Class.attributes)if(this.Class.attributes.hasOwnProperty(b))a[b]=this.attr(b)}return a},isNew:function(){var a=j(this);return a===undefined||a===null},save:function(a,b){return g(this,this.isNew()?"create":"update",a,b)},destroy:function(a,b){return g(this,"destroy",a,b,"destroyed")},identity:function(){var a=
j(this);return this.Class._fullName+"_"+(this.Class.escapeIdentity?encodeURIComponent(a):a)},elements:function(a){return $("."+this.identity(),a)},publish:function(a,b){this.Class.publish(a,b||this)},hookup:function(a){var b=this.Class._shortName,c=$.data(a,"models")||$.data(a,"models",{});$(a).addClass(b+" "+this.identity());c[b]=this}});$.Model.wrapMany=$.Model.models;$.Model.wrap=$.Model.model;v(["created","updated","destroyed"],function(a,b){$.Model.prototype[b]=function(c){b==="destroyed"&&this.Class.list&&
this.Class.list.remove(j(this));c&&typeof c=="object"&&this.attrs(c.attrs?c.attrs():c);$(this).triggerHandler(b);this.publish(b,this);$([this.Class]).triggerHandler(b,this);return[this].concat(A(arguments))}});$.fn.models=function(){var a=[],b,c;this.each(function(){v($.data(this,"models")||{},function(h,k){b=b===undefined?k.Class.List||null:k.Class.List===b?b:null;a.push(k)})});c=d(b);c.push.apply(c,m(a));return c};$.fn.model=function(a){if(a&&a instanceof $.Model){a.hookup(this[0]);return this}else return this.models.apply(this,
arguments)[0]}})(jQuery);
