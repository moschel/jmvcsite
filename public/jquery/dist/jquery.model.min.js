(function(k){var j=false,m=/xyz/.test(function(){})?/\b_super\b/:/.*/,n=function(c,e,a){a=a||c;for(var b in c)a[b]=typeof c[b]=="function"&&typeof e[b]=="function"&&m.test(c[b])?function(d,h){return function(){var g=this._super,f;this._super=e[d];f=h.apply(this,arguments);this._super=g;return f}}(b,c[b]):c[b]};jQuery.Class=function(){arguments.length&&jQuery.Class.extend.apply(jQuery.Class,arguments)};k.extend(k.Class,{callback:function(c){var e=jQuery.makeArray(arguments),a;c=e.shift();jQuery.isArray(c)||
(c=[c]);a=this;return function(){for(var b=e.concat(jQuery.makeArray(arguments)),d,h=c.length,g=0,f;g<h;g++)if(f=c[g]){if((d=typeof f=="string")&&a._set_called)a.called=f;b=(d?a[f]:f).apply(a,b||[]);if(g<h-1)b=!jQuery.isArray(b)||b._use_call?[b]:b}return b}},getObject:function(c,e){e=e||window;c=c?c.split(/\./):[];for(var a=0;a<c.length;a++)e=e[c[a]]||(e[c[a]]={});return e},newInstance:function(){var c=this.rawInstance(),e;if(c.setup)e=c.setup.apply(c,arguments);if(c.init)c.init.apply(c,k.isArray(e)?
e:arguments);return c},setup:function(c){this.defaults=k.extend(true,{},c.defaults,this.defaults);return arguments},rawInstance:function(){j=true;var c=new this;j=false;return c},extend:function(c,e,a){function b(){if(!j)return this.constructor!==b&&arguments.length?this.extend.apply(this,arguments):this.Class.newInstance.apply(this.Class,arguments)}if(typeof c!="string"){a=e;e=c;c=null}if(!a){a=e;e=null}a=a||{};var d=this,h=this.prototype,g,f,i,l;j=true;l=new this;j=false;n(a,h,l);for(g in this)if(this.hasOwnProperty(g)&&
k.inArray(g,["prototype","defaults","getObject"])==-1)b[g]=this[g];n(e,this,b);if(c){i=c.split(/\./);f=i.pop();i=h=k.Class.getObject(i.join("."));h[f]=b}k.extend(b,{prototype:l,namespace:i,shortName:f,constructor:b,fullName:c});b.prototype.Class=b.prototype.constructor=b;d=b.setup.apply(b,[d].concat(k.makeArray(arguments)));if(b.init)b.init.apply(b,d||[]);return b}});jQuery.Class.prototype.callback=jQuery.Class.callback})(jQuery);
(function(k){var j={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowerUpper:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g},m=function(c,e,a){e=e||window;c=c?c.split(/\./):[];for(var b,d=0;d<c.length-1&&e;d++)e=e[c[d]];b=e[c[d]];a&&delete e[c[d]];return b},n=k.String={strip:function(c){return c.replace(/^\s+/,"").replace(/\s+$/,"")},capitalize:function(c){return c.charAt(0).toUpperCase()+c.substr(1)},endsWith:function(c,e){var a=c.length-e.length;return a>=0&&c.lastIndexOf(e)===
a},camelize:function(c){c=c.split(j.undHash);var e=1;for(c[0]=c[0].charAt(0).toLowerCase()+c[0].substr(1);e<c.length;e++)c[e]=n.capitalize(c[e]);return c.join("")},classize:function(c){c=c.split(j.undHash);for(var e=0;e<c.length;e++)c[e]=n.capitalize(c[e]);return c.join("")},niceName:function(c){c=c.split(j.undHash);for(var e=0;e<c.length;e++)c[e]=n.capitalize(c[e]);return c.join(" ")},underscore:function(c){return c.replace(j.colons,"/").replace(j.words,"$1_$2").replace(j.lowerUpper,"$1_$2").replace(j.dash,
"_").toLowerCase()},sub:function(c,e,a){return c.replace(j.replacer,function(b,d){return m(d,e,a).toString()})}}})(jQuery);
(function(){var k=$.String.underscore,j=$.String.classize,m=function(a,b,d,h,g,f){b=$.extend({},b);a=$.String.sub(a,b,true);$.ajax({url:a,data:b,success:d,error:h,type:f||"post",dataType:"json",fixture:g})},n=function(){return"//"+$.String.underscore(this.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+$.String.underscore(this.shortName)},c=function(a,b){a=a||{};if(a[this.id]){a["new"+$.String.capitalize(this.id)]=a[this.id];delete a[this.id]}a[this.id]=b;return a},e={create:function(a){return function(b,
d,h){m(a,b,d,h,"-restCreate")}},update:function(a){return function(b,d,h,g){m(a,c.call(this,d,b),h,g,"-restUpdate")}},destroy:function(a){return function(b,d,h){var g={};g[this.id]=b;m(a,g,d,h,"-restDestroy")}},findAll:function(a){return function(b,d,h){m(a,b,this.callback(["wrapMany",d]),h,n.call(this)+"s.json","get")}},findOne:function(a){return function(b,d,h){m(a,b,this.callback(["wrap",d]),h,n.call(this)+".json","get")}}};jQuery.Class.extend("jQuery.Model",{setup:function(a){if(!this.attributes||
a.attributes===this.attributes)this.attributes={};if(!this.associations||a.associations===this.associations)this.associations={};if(!this.validations||a.validations===this.validations)this.validations={};if(a.convert!=this.convert)this.convert=$.extend(a.convert,this.convert);this._fullName=k(this.fullName.replace(/\./g,"_"));if(this.fullName.substr(0,7)!="jQuery."){jQuery.Model.models[this._fullName]=this;if(this.listType)this.list=new this.listType([]);for(var b in e)if(typeof this[b]==="string")this[b]=
e[b](this[b])}},attributes:{},defaults:{},wrap:function(a){if(!a)return null;return new this(a[this.singularName]||a.data||a.attributes||a)},wrapMany:function(a){if(!a)return null;var b=new (this.List||$.Model.List||Array),d=$.isArray(a),h=d?a:a.data,g=h.length,f=0;for(b._use_call=true;f<g;f++)b.push(this.wrap(h[f]));if(!d)for(var i in a)if(i!=="data")b[i]=a[i];return b},id:"id",addAttr:function(a,b){if(!this.associations[a]){this.attributes[a]||(this.attributes[a]=b);return b}},models:{},publish:function(a,
b){window.OpenAjax&&OpenAjax.hub.publish(k(this.shortName)+"."+a,b)},guessType:function(a){if(typeof a!="string"){if(a===null)return typeof a;if(a.constructor==Date)return"date";if($.isArray(a))return"array";return typeof a}if(a==="")return"string";if(a=="true"||a=="false")return"boolean";if(!isNaN(a)&&isFinite(+a))return"number";return typeof a},convert:{date:function(a){return typeof a==="string"?isNaN(Date.parse(a))?null:Date.parse(a):a},number:function(a){return parseFloat(a)},"boolean":function(a){return Boolean(a)}}},
{setup:function(a){this._initializing=true;this.Class.defaults&&this.attrs(this.Class.defaults);this.attrs(a);delete this._initializing},update:function(a,b,d){this.attrs(a);return this.save(b,d)},errors:function(a){if(a)a=$.isArray(a)?a:$.makeArray(arguments);var b={},d=this,h=function(f,i){$.each(i,function(l,o){if(l=o.call(d)){b.hasOwnProperty(f)||(b[f]=[]);b[f].push(l)}})};$.each(a||this.Class.validations||{},function(f,i){if(typeof f=="number"){f=i;i=d.Class.validations[f]}h(f,i||[])});for(var g in b)if(b.hasOwnProperty(g))return b;
return null},attr:function(a,b,d,h){var g=j(a),f="get"+g;if(b!==undefined){this._setProperty(a,b,d,h,g);return this}return this[f]?this[f]():this[a]},bind:function(){var a=$(this);a.bind.apply(a,arguments);return this},unbind:function(){var a=$(this);a.unbind.apply(a,arguments);return this},_setProperty:function(a,b,d,h,g){g="set"+g;var f=this[a],i=this,l=function(o){h&&h.call(i,o);$(i).triggerHandler("error."+a,o)};this[g]&&(b=this[g](b,this.callback("_updateProperty",a,b,f,d,l),l))===undefined||
this._updateProperty(a,b,f,d,l)},_updateProperty:function(a,b,d,h,g){var f=this.Class,i=f.attributes[a]||f.addAttr(a,f.guessType(b)),l=f.convert[i];i=null;b=this[a]=b===null?null:l?l.call(f,b):b;this._initializing||(i=this.errors(a));if(i)g(i);else{d!==b&&!this._initializing&&$(this).triggerHandler(a,b);h&&h(this)}if(a==f.id&&b!==null&&f.list)if(d){if(d!=b){f.list.remove(d);f.list.push(this)}}else f.list.push(this)},attrs:function(a){var b;if(a){var d=this.Class.id;for(b in a)b!=d&&this.attr(b,a[b]);
d in a&&this.attr(d,a[d])}else{a={};for(b in this.Class.attributes)if(this.Class.attributes.hasOwnProperty(b))a[b]=this.attr(b)}return a},isNew:function(){var a=this[this.Class.id];return a===undefined||a===null},save:function(a,b){if(this.errors())return false;this.isNew()?this.Class.create(this.attrs(),this.callback(["created",a]),b):this.Class.update(this[this.Class.id],this.attrs(),this.callback(["updated",a]),b);return true},destroy:function(a,b){this.Class.destroy(this[this.Class.id],this.callback(["destroyed",
a]),b)},identity:function(){var a=this[this.Class.id];return this.Class._fullName+"_"+(this.Class.escapeIdentity?encodeURIComponent(a):a)},elements:function(a){return $("."+this.identity(),a)},publish:function(a,b){this.Class.publish(a,b||this)},hookup:function(a){var b=k(this.Class.shortName),d=$.data(a,"models")||$.data(a,"models",{});$(a).addClass(b+" "+this.identity());d[b]=this}});$.each(["created","updated","destroyed"],function(a,b){$.Model.prototype[b]=function(d){b==="destroyed"&&this.Class.list&&
this.Class.list.remove(this[this.Class.id]);$(this).triggerHandler(b);d&&typeof d=="object"&&this.attrs(d.attrs?d.attrs():d);this.publish(b,this);return[this].concat($.makeArray(arguments))}});$.fn.models=function(){var a=[],b,d;this.each(function(){$.each($.data(this,"models")||{},function(h,g){b=b===undefined?g.Class.List||null:g.Class.List===b?b:null;a.push(g)})});d=new (b||$.Model.List||Array);d.push.apply(d,$.unique(a));return d};$.fn.model=function(a){if(a&&a instanceof $.Model){a.hookup(this[0]);
return this}else return this.models.apply(this,arguments)[0]}})(jQuery);
